{"is_source_file": true, "format": "Python", "description": "This file provides a Python module implementing a chat-based AI assistant using OpenAI's API, with functions for message handling, API calls, fallbacks, and prompt generation.", "external_files": ["src/api/schemas", "src/config"], "external_methods": ["src.api.schemas.Message", "src.api.schemas.RoleEnum", "src.config.settings"], "published": ["generate_reply", "summarize_prompt"], "classes": [], "methods": [{"name": "bool _openai_is_configured()", "description": "Checks whether the OpenAI API is configured via environment settings.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _extract_last_user_message(messages: List[Message])", "description": "Retrieves the content of the last message from the user in the conversation history.", "scope": "", "scopeKind": ""}, {"name": "List[dict] _build_messages_for_openai(messages: List[Message], response_style: Optional[str])", "description": "Constructs the message payload for OpenAI API, including system prompts and message history.", "scope": "", "scopeKind": ""}, {"name": "dict _build_openai_payload(messages: List[Message], response_style: Optional[str])", "description": "Builds the complete request payload for OpenAI chat completion API.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _call_openai(messages: List[Message], response_style: Optional[str])", "description": "Makes the API call to OpenAI chat completion endpoint and returns the generated reply or None on error.", "scope": "", "scopeKind": ""}, {"name": "str _deterministic_fallback_reply(messages: List[Message], response_style: Optional[str])", "description": "Provides a heuristic fallback reply when API call fails, tailored from user message content.", "scope": "", "scopeKind": ""}, {"name": "str generate_reply(messages: List[Message], response_style: Optional[str] = None)", "description": "Main function to generate an assistant reply, calling OpenAI API if configured, otherwise falling back to heuristics.", "scope": "", "scopeKind": ""}, {"name": "str summarize_prompt(prompt: str)", "description": "Creates a concise, 'summary-style' hint based on the prompt for use as a minimal response cue.", "scope": "", "scopeKind": ""}], "calls": ["src.api.schemas.Message", "src.api.schemas.RoleEnum", "settings.OPENAI_API_KEY", "settings.OPENAI_MODEL", "httpx.Client.post"], "search-terms": ["chat.py", "OpenAI chat API", "fallback heuristic", "message building", "prompt summarization", "task-focused assistant", "conversational AI", "list-style responses"], "state": 2, "file_id": 6, "knowledge_revision": 53, "git_revision": "cab4e039bd7312c8402178b1e7ba5a1cf262cdf1", "revision_history": [{"13": "e27cab233c6df5353338e43a779cb65c198264eb"}, {"15": "e27cab233c6df5353338e43a779cb65c198264eb"}, {"34": "e27cab233c6df5353338e43a779cb65c198264eb"}, {"48": "abaa71d265cdf42d7c76a31c44f2c80d59ea2967"}, {"53": "cab4e039bd7312c8402178b1e7ba5a1cf262cdf1"}], "ctags": [{"_type": "tag", "name": "DEFAULT_GREETING", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^DEFAULT_GREETING = ($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "MAX_INPUT_CHARS", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^MAX_INPUT_CHARS = 5000$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "MAX_RESPONSE_CHARS", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^MAX_RESPONSE_CHARS = 4000$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "OPENAI_CHAT_URL", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^OPENAI_CHAT_URL = \"https:\\/\\/api.openai.com\\/v1\\/chat\\/completions\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "OPENAI_DEFAULT_MODEL", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^OPENAI_DEFAULT_MODEL = \"gpt-4o-mini\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SYSTEM_PROMPT_BASE", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^SYSTEM_PROMPT_BASE = ($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SYSTEM_PROMPT_LIST_HINT", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^SYSTEM_PROMPT_LIST_HINT = ($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_build_messages_for_openai", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _build_messages_for_openai(messages: List[Message], response_style: Optional[str]) -> List[d/", "language": "Python", "typeref": "typename:List[dict]", "kind": "function", "signature": "(messages: List[Message], response_style: Optional[str])"}, {"_type": "tag", "name": "_build_openai_payload", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _build_openai_payload(messages: List[Message], response_style: Optional[str]) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(messages: List[Message], response_style: Optional[str])"}, {"_type": "tag", "name": "_call_openai", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _call_openai(messages: List[Message], response_style: Optional[str]) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(messages: List[Message], response_style: Optional[str])"}, {"_type": "tag", "name": "_deterministic_fallback_reply", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _deterministic_fallback_reply(messages: List[Message], response_style: Optional[str]) -> str/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(messages: List[Message], response_style: Optional[str])"}, {"_type": "tag", "name": "_extract_last_user_message", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _extract_last_user_message(messages: List[Message]) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(messages: List[Message])"}, {"_type": "tag", "name": "_openai_is_configured", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _openai_is_configured() -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "generate_reply", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def generate_reply(messages: List[Message], response_style: Optional[str] = None) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(messages: List[Message], response_style: Optional[str] = None)"}, {"_type": "tag", "name": "summarize_prompt", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def summarize_prompt(prompt: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(prompt: str)"}], "hash": "fabba494354e72fd6e7712bebfd59fc2", "format-version": 4, "code-base-name": "fastapi_backend", "filename": "fastapi_backend/src/services/chat.py", "fields": [{"name": "DEFAULT_GREETING = (", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "MAX_INPUT_CHARS = 5000", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "MAX_RESPONSE_CHARS = 4000", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "OPENAI_CHAT_URL = \"https:\\/\\/api.openai.com\\/v1\\/chat\\/completions\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "OPENAI_DEFAULT_MODEL = \"gpt-4o-mini\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SYSTEM_PROMPT_BASE = (", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SYSTEM_PROMPT_LIST_HINT = (", "scope": "", "scopeKind": "", "description": "unavailable"}]}