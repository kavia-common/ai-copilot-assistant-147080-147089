{"is_source_file": true, "format": "Python", "description": "This file implements a service for handling chat interactions with an AI assistant, including prompt construction, API calls to OpenAI, and fallback responses.", "external_files": ["src.api.schemas", "src.config"], "external_methods": ["settings.OPENAI_API_KEY", "settings.OPENAI_MODEL"], "published": ["MAX_INPUT_CHARS", "DEFAULT_GREETING", "OPENAI_CHAT_URL", "OPENAI_DEFAULT_MODEL", "SYSTEM_PROMPT_BASE", "SYSTEM_PROMPT_LIST_HINT", "SYSTEM_PROMPT_GUIDED", "_openai_is_configured", "_extract_last_user_message", "_build_messages_for_openai", "_build_openai_payload", "_call_openai", "_deterministic_fallback_reply"], "classes": [], "methods": [{"name": "bool _openai_is_configured()", "description": "Checks whether the OpenAI API key is configured in settings.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _extract_last_user_message(messages: List[Message])", "description": "Retrieves the last user message content from a list of messages.", "scope": "", "scopeKind": ""}, {"name": "List[dict] _build_messages_for_openai(messages: List[Message], response_style: Optional[str])", "description": "Constructs the message sequence to send to OpenAI, ensuring the correct prompt structure.", "scope": "", "scopeKind": ""}, {"name": "dict _build_openai_payload(messages: List[Message], response_style: Optional[str])", "description": "Creates the payload for the OpenAI chat completion API, including model and message data.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _call_openai(messages: List[Message], response_style: Optional[str])", "description": "Sends a request to the OpenAI API and returns the assistant's reply, or None on failure.", "scope": "", "scopeKind": ""}, {"name": "str _deterministic_fallback_reply(messages: List[Message], response_style: Optional[str])", "description": "Provides a concise, rule-based fallback reply when API call fails or is unconfigured.", "scope": "", "scopeKind": ""}], "calls": ["httpx.Client", "settings.OPENAI_API_KEY", "settings.OPENAI_MODEL"], "search-terms": ["chat service", "OpenAI API integration", "prompt construction", "fallback reply", "chat messages handling"], "state": 2, "file_id": 6, "knowledge_revision": 64, "git_revision": "dcd100df8d4150de9e828c133734c0a4a2d2fa37", "revision_history": [{"13": "e27cab233c6df5353338e43a779cb65c198264eb"}, {"15": "e27cab233c6df5353338e43a779cb65c198264eb"}, {"34": "e27cab233c6df5353338e43a779cb65c198264eb"}, {"48": "abaa71d265cdf42d7c76a31c44f2c80d59ea2967"}, {"53": "cab4e039bd7312c8402178b1e7ba5a1cf262cdf1"}, {"56": "6c70cf123600356025f5691450d9d9b7fccf0ee9"}, {"57": "6c70cf123600356025f5691450d9d9b7fccf0ee9"}, {"58": "6c70cf123600356025f5691450d9d9b7fccf0ee9"}, {"64": "dcd100df8d4150de9e828c133734c0a4a2d2fa37"}], "ctags": [{"_type": "tag", "name": "DEFAULT_GREETING", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^DEFAULT_GREETING = ($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "MAX_INPUT_CHARS", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^MAX_INPUT_CHARS = 5000$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "MAX_RESPONSE_CHARS", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^MAX_RESPONSE_CHARS = 4000$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "OPENAI_CHAT_URL", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^OPENAI_CHAT_URL = \"https:\\/\\/api.openai.com\\/v1\\/chat\\/completions\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "OPENAI_DEFAULT_MODEL", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^OPENAI_DEFAULT_MODEL = \"gpt-4o-mini\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SYSTEM_PROMPT_BASE", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^SYSTEM_PROMPT_BASE = ($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SYSTEM_PROMPT_GUIDED", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^SYSTEM_PROMPT_GUIDED = ($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SYSTEM_PROMPT_LIST_HINT", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^SYSTEM_PROMPT_LIST_HINT = ($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_build_messages_for_openai", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _build_messages_for_openai(messages: List[Message], response_style: Optional[str]) -> List[d/", "language": "Python", "typeref": "typename:List[dict]", "kind": "function", "signature": "(messages: List[Message], response_style: Optional[str])"}, {"_type": "tag", "name": "_build_openai_payload", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _build_openai_payload(messages: List[Message], response_style: Optional[str]) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(messages: List[Message], response_style: Optional[str])"}, {"_type": "tag", "name": "_call_openai", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _call_openai(messages: List[Message], response_style: Optional[str]) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(messages: List[Message], response_style: Optional[str])"}, {"_type": "tag", "name": "_deterministic_fallback_reply", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _deterministic_fallback_reply(messages: List[Message], response_style: Optional[str]) -> str/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(messages: List[Message], response_style: Optional[str])"}, {"_type": "tag", "name": "_extract_last_user_message", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _extract_last_user_message(messages: List[Message]) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(messages: List[Message])"}, {"_type": "tag", "name": "_openai_is_configured", "path": "/home/kavia/workspace/code-generation/ai-copilot-assistant-147080-147089/fastapi_backend/src/services/chat.py", "pattern": "/^def _openai_is_configured() -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "()"}], "hash": "4c2058f3779aea53cda27c0609f23420", "format-version": 4, "code-base-name": "fastapi_backend", "filename": "fastapi_backend/src/services/chat.py", "fields": [{"name": "DEFAULT_GREETING = (", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "MAX_INPUT_CHARS = 5000", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "MAX_RESPONSE_CHARS = 4000", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "OPENAI_CHAT_URL = \"https:\\/\\/api.openai.com\\/v1\\/chat\\/completions\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "OPENAI_DEFAULT_MODEL = \"gpt-4o-mini\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SYSTEM_PROMPT_BASE = (", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SYSTEM_PROMPT_GUIDED = (", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SYSTEM_PROMPT_LIST_HINT = (", "scope": "", "scopeKind": "", "description": "unavailable"}]}